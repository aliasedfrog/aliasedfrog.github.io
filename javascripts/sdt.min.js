$(document).ready(function(){function e(e){if(e.serverMapList!=null){var t="";for(i=0;i<e.serverMapList.length;i++){if(i!=0){t+='", "'+e.serverMapList[i].name}else{t+='"'+e.serverMapList[i].name}if(i==e.serverMapList.length-1||e.serverMapList.length==1){t+='"'}}return t}}function t(e){if(e.serverMapList!=null){var t="";for(i=0;i<e.serverMapList.length;i++){if(i!=0){t+='</b>", "<b>'+e.serverMapList[i].name}else{t+='"<b>'+e.serverMapList[i].name}if(i==e.serverMapList.length-1||e.serverMapList.length==1){t+='</b>"'}}return t}}function c(e,t){var n="Type: "+e.serverType.substring(0,1).toUpperCase()+e.serverType.substring(1,e.serverType.length);$(t).find("td:nth(1)").attr("title",n);var r="Country: "+e.locale.countryName+" Region: "+e.locale.regionName;$(t).find("td:nth(3)").attr("title",r);var i="Uptime based on server response to query, only provides example of how long the server has been active";$(t).find("td:nth(7)").attr("title",i);var s="Last response date & time was: "+e.lastResponse;$(t).find("td:nth(9)").attr("title",s)}function h(e,t){var n="Server popularity scale 0/100, gains 1 each query with more than 2 players, loses 0.5 each query less than 2 players";if(e.popularity>75){$(t).find("td:first").attr("title",n).css("background-image","linear-gradient(to right, green, blue,rgb(255, 255, 255))")}else if(e.popularity>50){$(t).find("td:first").attr("title",n).css("background-image","linear-gradient(to right, yellow ,green,rgb(255, 255, 255))")}else if(e.popularity>25){$(t).find("td:first").attr("title",n).css("background-image","linear-gradient(to right, red ,yellow,rgb(255, 255, 255))")}else{$(t).find("td:first").attr("title",n).css("background-image","linear-gradient(to right, red ,red,rgb(255, 255, 255))")}}var n=60;var r;var s;var o=function(e){s=$.ajax({url:buildJSONPath("json","servers","online"),data:{format:"json"},dataType:"json",success:function(t,i,s){populateMenu(t);$("div.mapInfo").html('<h6 class="mapHeader">Maps seen on server:<br/></h6>');r=t;e.clear();e.rows.add(t.data);e.columns.adjust().draw();$("#sdt").closest("table").height(calcDataTableHeight(n)).width("1032px");$("#sidtheader").height($("div.mapInfo").height()-$("#sidt_info").height())},type:"GET"})};var u=window.setInterval(function(){var e=$("#sdt").DataTable();o(e)},12e4);var a=$("#sdt").DataTable({search:{caseInsensitive:true},language:{processing:"Loading server information...",infoEmpty:"No servers found.",zeroRecords:"No servers matched your search.",infoEmpty:"Showing 0 servers",info:"_TOTAL_ servers"},columns:[{title:"Pop",defaultContent:"",data:"popularity",width:"1%",orderable:false},{title:"T",defaultContent:"",data:"serverType",width:"1%",orderable:false,render:function(e,t,n,r){return e.substring(0,1).toUpperCase()}},{title:"Name",defaultContent:"",data:"serverName"},{title:"Loc",defaultContent:"",data:"locale",width:"1%",render:function(e,t,n,r){var i='<div class="centered">';if(e.countryCode!=""&&e.countryCode!=null){var s=e.countryCode.toLowerCase()+".gif";i+='<img src="//aliasedfrog.github.io/images/'+s+'"/><br/>'}else{i+="[?]"}if(e.regionCode!=""&&e.regionCode!=null){i+='<span style="font-size: x-small">['+e.regionCode+"]</span>"}return i+"</div>"}},{title:"Ip:Port",defaultContent:"",orderable:false,data:"ipAddress",width:"1%",render:function(e,t,n,r){return'<a class="btn btn-mini btn-success text-center" style="width: 120px;" href="steam://connect/'+e+":"+n.serverPort+'">'+e+":"+n.serverPort+"</a>"}},{title:"Map",defaultContent:"",data:"map.name",width:"1%"},{title:"Plyrs",searchable:false,defaultContent:"",data:"playerCount",width:"1%",render:function(e,t,n,r){return e+"/"+n.maxPlayers}},{title:"UpTime",defaultContent:"",searchable:false,data:"serverUpTime",width:"1%",orderable:false},{title:"Vers",defaultContent:"",data:"gameVersion",width:"1%"},{title:"Last",defaultContent:"",searchable:false,data:"lastResponse",width:"1%"},{title:"Maps",defaultContent:"",orderable:false,data:"serverMapList",width:"1%",visible:false,render:function(e,t,n,r){var s="";for(i=0;i<e.length;i++){s+=e[i].name+" "}return s}}],scrollY:calcDataTableHeight(n),scrollCollapse:true,order:[[0,"desc"],[6,"desc"],[8,"desc"],[9,"desc"]],paging:false,deferRender:true,dom:'<"row"<"mapInfo span8" ><"span3 offset1 pull-right"f>>lrt',autoWidth:false,processing:false,createdRow:function(t,n,r){h(n,t);c(n,t);if(n.serverMapList!=null){t.title="Known Maps=("+e(n)+")"}},columnDefs:[{render:function(e,t,n,r){return'<span style="font-size: xx-small;line-height:6px">'+e+"</span>"},targets:[9,10]},{className:"tdTextCenter centerVert",targets:[0,1]},{className:"centerVert",targets:"_all"}]});o(a);var f=$("#sidt").DataTable({language:{processing:"Loading player information...",infoEmpty:"No players found.",zeroRecords:"No server selected.",infoEmpty:"No server selected.",info:"_TOTAL_ players"},columns:[{title:"Name",data:"name",render:function(e,t,n,r){if(e.length>10){return e.substring(0,9)}return e}},{title:"Score",data:"score",width:"1%"},{title:"Time",data:"connectTime",width:"1%"}],processing:false,autoWidth:false,order:[[1,"asc"],[0,"asc"]],scrollY:calcDataTableHeight(n),scrollCollapse:false,paging:false,deferRender:true,dom:"irt",height:calcDataTableHeight(n),width:"265px"});$("#sidt").closest("table").height(calcDataTableHeight(n)).width("255px");var l;$("#sdt tbody").on("click","tr",function(){var e=$("#sdt").DataTable();var r=$(this).closest("tr");var i=e.row(r);var s=i.data();$("div.mapInfo").html('<h6 class="mapHeader">Maps seen on server: '+t(s)+"</h6>");e.rows(".info").nodes().to$().removeClass("info");if(s.serverName==l){l=null;f.clear()}else{f.clear();f.rows.add(s.playerList);l=s.serverName;$(this).addClass("info")}f.columns.adjust().draw();$("#sidtheader").height($("div.mapInfo").height()-$("#sidt_info").height());$("#sidt").closest("table").height(calcDataTableHeight(n)).width("255px")})})
